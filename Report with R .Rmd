---
title: Will Donald Trump win the 2020 Presidential Election? A statistical analysis on American
  survey and census data.
author: "Siyi Ma, Heye Liu, Yan Wang, Yuanzhe Yang"
date: "11/01/2020"
output:
  word_document: default
  html_document: default
---

```{r setup, include=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(haven)
library(tidyverse)
library(lme4)
library(lattice)
library(MASS)
setwd("~/Desktop/Data")
survey_data <- read.csv("survey_data.csv")
census_data <- read.csv("census_data.csv")
```

## Introducion

The 2020 U.S. Presidential race between Republican candidate Donald Trump and Democrat candidate Joe Biden appears to be heating up until Election day on November 3. It attracts all the attentions of the world regarding the esteemed economic strength and super-powered political position of U.S. In this study, we focus on two datasets containing information from a poll survey and demographic census. Hierarchical logistic regression models are conducted on survey data for investigating any factors that are statistically related with the probability of voting for Donald Trump. Then we apply a trained model to the census dataset to make a reasonable prediction on election result.

## Data 

The survey dataset for modeling is original from Democracy Fund + UCLA Nationscape. For modeling with neat and organized data, we have processed data cleaning at initial. For instance, we only focus on individuals who have registered for voting; we create an age group such that age is a categorized variable instead of a continuous one; the household income is classified with three levels, lower, middle and upper. Additionally, we also reformat the race ethnicities and education background for more explicit explanation. After removing missing values, the survey dataset contains 3,879 observations and 8 variables, including both geographic variables like state, and demographic variables, gender and age.

```{r}
survey_data %>% 
  ggplot(mapping = aes(x = state, fill = voteintention)) +
  geom_bar() + 
  labs(x = "State",
       y = "Count")
```

Figure 1. Support proportions of Trump and Biden across U.S.

## Method

Since the response variable we targeted is distichous: either supports Trump or supports Biden. The intuition for modeling this typical data is a generalized linear model with a logit link. However, the system of Presidential Election in U.S. is determined by the Electoral College, which means that a candidate who obtains the most votes may not win the election. For instance, In the 2016 Presidential Election, Hillary Clinton had nearly 3 million more votes than Trump in the final vote count, but Trump became the president. In Figure 1, it also shows that the supporting proportion of Trump and Biden do vary dramatically across the whole country, therefore, the geographic variation should be taken in to consideration for more reasonable and accurate modeling refers to a rate of supporting. 

### Variance Component Model 

Variance components model is a multilevel model without explanatory variable which could be used to explain the variation in the tendency of supporting Trump that can be attributed to the states, for a bianry response, it has a basic form as follows:

$$
Y_{ij} \sim Binomial(\pi_{ij}) \\
logit(\pi_{ij}) = \mathbf{X}_{i}\beta + \mu_j+\epsilon_{ij}
$$
where $\pi_{ij}$ is the probability of $i$th individual voting Trump living in $j$th state, $j$th is the deviation in probability of voting Trumpof at $j$th states from average, $\epsilon_{ij}$ is the error term. From Figure 2, 

```{r}
# null model
fit0 <- glm(vote_trump ~  1, data = survey_data, family = "binomial" )
# variation in states
fit_st <- glmer(vote_trump ~  1 + (1 | state), data = survey_data, family = "binomial")
anova(fit_st, fit0)
summary(fit_st)
dotplot(ranef(fit_st))
anova(fit_st, fit0)

```


The estimated random effect generated by variance component model are shown in Figure 2. The graphic evidence does indicate that the proportion of supporting Trump varies from state to state. However, we notice that, for a substantial number of states, the 95% confidence interval overlap the horizontal line at zero, indicating that likelihood of supporting Trump in these states are not significantly above average or below average. On the other hand, a likelihood ratio test between the logistic variance component model and a null logistic model does show that the multilevel model does show a significant improvement in model fitting than a single level model. 

### Variable selection

In order to allocate an appropriate combination of explanatory variables for fitting our model, we apply the method of forward and backward stepwise regression proposed by Efroymson (1960). The algorithms within this selection process is straightforward by a series of criteria, such as AIC, BIC and Mallows's Cp. By applying R programming, we have a stepwise selected model with variables of gender, age group, race ethnicities, educational background, income level and working status. 


```{r}
full.model <- glm(vote_trump ~gender + agegroup + race + incomelevel + educationl + workingstatus, family = "binomial", data = survey_data)
step.model <- stepAIC(full.model, direction = "both", 
                      trace = FALSE)

```

### Post-Stratification

The multilevel regression with post-stratification (MRP) is a technique that is prevalent and frequently applied in predicting election results from polling. The fundamental idea of MRP is estimate the targeted population from the multilevel regression on a sample population, which is a convenient method to estimate public opinion across geographic units from individual-level survey data. For survey and census data we performed in this study, all the variables in census dataset we would utilize for prediction are reorganized to keep consistency with the ones we selected for regression. 

## Results

Other than geographic variation in the rate of supporting Trump, we also find that there are variations across different level of variables, i.e., random effects on gender, race, age group and even income level are substantially detected from Figure 3. 

Furthermore, the regression results of GLMM in Table 1 and Table 2 show that, gender, age group, race, income level and working status are statistically related with the likelihood of voting for Trump. For instance, the coefficient of gender is negatively estimated, implying that men voters are more enthusiastic for Trump than females. Specifically, the probability of supporting Trump for men voters is equal to the odds of female voters multiple a factor by . Likewise, older people with upper income (household income > $129,999) are more likely to be a fan of Trump. Additionally, there are divergence of supporting favor within race ethnicities: Comparing with Black American, the odds of voting for Trump in White American is overwhelming by multiple a factor of  on that odds of Black American.

Consequently, we apply this GLMM regression to the cleaning census dataset as the method of post-stratification, find that the proportion of voters in favor of voting for Donald Trump is 35.78%, implying that the chance of winning this presidential election for Trump is not promising if we barely consider the polling results on the survey and census data. However, as we mentioned above, the key of winning the U.S. election is the number of electoral district rather than the overall percentage of supported voters


```{r}
# variation in age
fit_age <- glmer(vote_trump ~  1 + (1 | agegroup), data = survey_data, family = "binomial")
fit_race <- glmer(vote_trump ~  1 + (1 | race), data = survey_data, family = "binomial")
fit_income <- glmer(vote_trump ~  1 + (1 | incomelevel), data = survey_data, family = "binomial")
fit_gender <- glmer(vote_trump ~  1 + (1 | gender), data = survey_data, family = "binomial")
fit_work <- glmer(vote_trump ~  1 + (1 | workingstatus), data = survey_data, family = "binomial")
fit_ed  <- glmer(vote_trump ~  1 + (1 | educationl), data = survey_data, family = "binomial")

dotplot(ranef(fit_age))
dotplot(ranef(fit_race))
dotplot(ranef(fit_income))
dotplot(ranef(fit_gender))
dotplot(ranef(fit_work))
dotplot(ranef(fit_ed))



stepfit <- glmer(vote_trump ~gender + agegroup + race  + educationl + incomelevel + workingstatus + (1|state), family = "binomial", data = survey_data)

(theCiMat = Pmisc::ciMat(0.95))
parTable = summary(
stepfit)$coef[, rownames(theCiMat)] %*% theCiMat
rownames(parTable)[1]= "Baseline"
knitr::kable(summary(stepfit)$coef, digits = 3)
knitr::kable(exp(parTable), digits = 3)

fit2 <- glm(vote_trump ~gender + agegroup + race  + educationl + workingstatus, family = "binomial", data = survey_data)
y <- predict(fit2, newdata = census_data, type = "response")
length(which(y > 0.5))/length(y)
```


## Discussion

In this study, we focus on two datasets containing information from a poll survey and demographic census. Variance component models and General linear multilevel models are conducted for detecting geographic variations and factors that are associated with the probability of voting for Donald Trump. The graphic and numeric evidence suggest that the variation in probability of voting for Trump changes across states, gender, age, income and education level, working status and race ethnicities are significantly related with the proportion of supporting Trump. Specifically, a white male American who have higher education and income level tend to vote for Trump rather than Biden. The post-stratification analysis on census dataset based on the trained model we applied provide a predicted overall proportion of voting for Trump is only 35.78%. Nevertheless, it does not mean that there is no chance of winning for Trump due to the electoral rules. 
Although some interesting facts we have found as we mentioned above, several drawbacks of this study should be notified and modified for further study. The first issue we consider about is the efficiency and accuracy of our hierarchical logistic regression model, Since GLMM is a straightforward frequentist model, which is estimated by the likelihood function on fixed given parameters. However, the willingness of supporting is a personal feeling and way to complicated on modeling, a Bayesian analysis might be more appropriate for thoroughly investigating the likelihood of supporting Trump.  For further study, we consider to summarize the our predicted proportion of voting Trump by states and compare our prediction once the outcome of the 2020 U.S. Presidential Election is revealed. 


